#!/bin/bash
sudo apt-get install stress

indent() {
  sed -u 's/^/       /'
}

for i in {1..10}
do
  echo "-----> step $i: allocating 10Gb of memory"
  dd if=/dev/urandom of=$i.bin bs=64M count=16 iflag=fullblock
  free -m | awk 'NR==2{printf "%.2f%%\t\t", $3*100/$2 }'
  echo "sleeping for 5 seconds" | indent
  sleep 5
done

echo "-----> Memory consumption complete!"
echo "Something should have broken by now." | indent
